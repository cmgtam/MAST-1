<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Installation &mdash; MAST 1.3.0.17 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3.0.17',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MAST 1.3.0.17 documentation" href="index.html" />
    <link rel="next" title="7. Trying out MAST" href="17_0_testmast.html" />
    <link rel="prev" title="5. Recipes" href="4_0_recipe.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="17_0_testmast.html" title="7. Trying out MAST"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="4_0_recipe.html" title="5. Recipes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MAST 1.3.0.17 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>6. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="do-pre-installation-steps">
<h2>6.1. Do pre-installation steps<a class="headerlink" href="#do-pre-installation-steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="locate-your-user-profile">
<h3>6.1.1. Locate your user profile<a class="headerlink" href="#locate-your-user-profile" title="Permalink to this headline">¶</a></h3>
<p>Your user profile will set up environment variables like <code class="docutils literal"><span class="pre">$PATH</span></code> when you log in.</p>
<p>This installation will ask you to modify your user profile several times.</p>
<p>If you are comfortable modifying your user profile, please skip to <a class="reference internal" href="#use-cluster-correctly"><span>Use your cluster correctly</span></a>.</p>
<p>For others:</p>
<ul>
<li><p class="first">Your user profile is probably located in your home directory as <code class="docutils literal"><span class="pre">//home/&lt;username&gt;/&lt;user</span> <span class="pre">profile</span> <span class="pre">name&gt;</span></code>, for example, <code class="docutils literal"><span class="pre">//home/&lt;username&gt;/.bashrc</span></code></p>
</li>
<li><p class="first">Common user profile names are <code class="docutils literal"><span class="pre">.bashrc</span></code>, <code class="docutils literal"><span class="pre">.bash_profile</span></code>, <code class="docutils literal"><span class="pre">.profile</span></code>, and <code class="docutils literal"><span class="pre">.profile_user</span></code></p>
<blockquote>
<div><ul>
<li><p class="first">These names usually start with a dot.</p>
</li>
<li><p class="first">You may need to use the command <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-a</span></code> to see these &#8220;hidden&#8221; files.</p>
</li>
<li><p class="first">Sometimes you may need to create your own user profile file.</p>
<blockquote>
<div><ul class="simple">
<li>For example, you may have a <code class="docutils literal"><span class="pre">.profile</span></code> file listed, but when you look at it, it tells you to create and modify a <code class="docutils literal"><span class="pre">.profile_user</span></code> file.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>After you save your changes to the user profile, you need to log out and then log back in, in order to see the changes take effect.</strong></p>
<blockquote>
<div><ul class="simple">
<li>Alternately, you can <code class="docutils literal"><span class="pre">source</span> <span class="pre">&lt;user</span> <span class="pre">profile</span> <span class="pre">name&gt;</span></code>, but occasionally this command will produce complications, for example, in path order.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>If you cannot locate your user profile, please contact your system administrator.</p>
</div>
<div class="section" id="use-your-cluster-correctly">
<span id="use-cluster-correctly"></span><h3>6.1.2. Use your cluster correctly<a class="headerlink" href="#use-your-cluster-correctly" title="Permalink to this headline">¶</a></h3>
<p>For this installation, please follow the correct procedures in order to avoid excessive headnode use on your cluster.</p>
<ul class="simple">
<li>For example, you may want to preface every command with <code class="docutils literal"><span class="pre">nice</span> <span class="pre">-n</span> <span class="pre">19</span></code> in order to reduce headnode load.</li>
<li>Or, your cluster may have a dedicated compile node, or it may support interactive queue submission.</li>
</ul>
<p>Please check with your cluster administrator if you are unsure of the correct procedures.</p>
</div>
</div>
<div class="section" id="install-local-python-version-and-dependencies">
<h2>6.2. Install local python version and dependencies<a class="headerlink" href="#install-local-python-version-and-dependencies" title="Permalink to this headline">¶</a></h2>
<p>MAST requires the following dependencies, some of which have additional dependencies:</p>
<ul class="simple">
<li>numpy</li>
<li>scipy</li>
<li>matplotlib</li>
<li>pymatgen</li>
<li>custodian</li>
<li>pandas</li>
<li>ase</li>
</ul>
<p>Currently, the Anaconda python package is preferred because it:</p>
<ul class="simple">
<li>automatically installs to a user directory and does not need root privileges</li>
<li>does not have the environment complications that the previously-recommended Enthought Canopy python has</li>
<li>can easily install numpy, scipy, and matplotlib.</li>
</ul>
<div class="section" id="install-anaconda-python">
<h3>6.2.1. Install Anaconda python<a class="headerlink" href="#install-anaconda-python" title="Permalink to this headline">¶</a></h3>
<p>Download the free installer from <a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda</a>. Use a Python 2.X version.</p>
<ul class="simple">
<li>Run the setup script. (e.g. <code class="docutils literal"><span class="pre">bash</span> <span class="pre">./Anaconda-&lt;version&gt;.sh</span></code>)</li>
<li>Follow the prompts and specify a local installation (use spacebar to scroll through the license file).</li>
</ul>
<p>When prompted, agree for the installer to add a line to your user profile to make this python installation your default python, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>export PATH=//home/&lt;username&gt;/anaconda/bin:$PATH
</pre></div>
</div>
<ul>
<li><p class="first">Log out and log back in. Verify that your python version is now the anaconda python version.:</p>
<div class="highlight-python"><div class="highlight"><pre>which python
</pre></div>
</div>
</li>
</ul>
<p>Use the conda command to install the following packages:</p>
<div class="highlight-python"><div class="highlight"><pre>conda install numpy scipy matplotlib
</pre></div>
</div>
<p>If you are developing for MAST, install the following packages:</p>
<div class="highlight-python"><div class="highlight"><pre>conda install numpy scipy matplotlib nose sphinx
</pre></div>
</div>
</div>
<div class="section" id="install-the-mast-package">
<h3>6.2.2. Install the MAST package<a class="headerlink" href="#install-the-mast-package" title="Permalink to this headline">¶</a></h3>
<p>Install the MAST package from the python package index:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install MAST
</pre></div>
</div>
<p>This command should install MAST, pymatgen, custodian, and pandas.</p>
<p>If pip cannot find anything (SSL certificate fail), try:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install MAST --cert &lt;path to conda&gt;/ssl/cacert.pem
</pre></div>
</div>
<p>If pymatgen cannot be installed because gcc cannot be found in order to compile spglib, then please see your system administrator.</p>
<p>If you need additional standalone tools (see <a class="reference internal" href="8_0_standalonetools.html"><em>Standalone Tools</em></a>) or unit tests, then also get and unzip the MAST tar.gz file (see <a class="reference internal" href="12_0_programming.html"><em>Programming for MAST</em></a>).</p>
</div>
<div class="section" id="install-additional-dependencies">
<h3>6.2.3. Install additional dependencies<a class="headerlink" href="#install-additional-dependencies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do a quick installation of ASE following the instructions on the <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/download.html">ASE website</a></li>
</ul>
</div>
</div>
<div class="section" id="set-up-the-pymatgen-vasp-psp-dir">
<span id="vasp-psp-dir"></span><h2>6.3. Set up the pymatgen VASP_PSP_DIR<a class="headerlink" href="#set-up-the-pymatgen-vasp-psp-dir" title="Permalink to this headline">¶</a></h2>
<p>This step is necessary if you are running VASP with MAST. If you are not running VASP with MAST, skip to <a class="reference internal" href="1_0_x_installation_old.html#install-mast"><span>Install MAST</span></a>.</p>
<div class="section" id="set-up-the-pseudopotential-folders">
<h3>6.3.1. Set up the pseudopotential folders<a class="headerlink" href="#set-up-the-pseudopotential-folders" title="Permalink to this headline">¶</a></h3>
<p>Locate the VASP pseudopotentials. If you cannot locate the VASP pseudopotentials, contact your system administrator or another person who uses VASP on the cluster.</p>
<p><code class="docutils literal"><span class="pre">which</span> <span class="pre">potcar_setup.py</span></code> should return the pymatgen utility for setting up your pseudopotential directories in the way that pymatgen requires.
If this command does not return a file location, then probably <code class="docutils literal"><span class="pre">$HOME/.local/bin</span></code> or <code class="docutils literal"><span class="pre">&lt;python</span> <span class="pre">installation</span> <span class="pre">directory&gt;/bin</span></code> is missing from your <code class="docutils literal"><span class="pre">$PATH</span></code> environment variable. See <a class="reference internal" href="1_0_x_installation_old.html#add-local-bin"><span>Add the .local/bin directory, if necessary</span></a>.</p>
<p>Run <code class="docutils literal"><span class="pre">potcar_setup.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">potcar_setup</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<ul>
<li><p class="first">The first directory address that you give to the utility is the directory that contains a few subdirectories, for example: potpaw_GGA, potpaw_LDA.52, potpaw_PBE.52, potUSPP_LDA, potpaw_LDA, potpaw_PBE, potUSPP_GGA.</p>
<blockquote>
<div><ul class="simple">
<li>These subdirectories themselves contain many sub-subdirectories with element names like Ac, Ac_s, Zr_sv, etc.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The second directory address that you give should be a new directory that you create.</p>
</li>
</ul>
<p>Once the new pymatgen-structured folders have been created, rename the GGA PBE folder to <code class="docutils literal"><span class="pre">POT_GGA_PAW_PBE</span></code>.</p>
<p>Later on, ingredients with a value of <code class="docutils literal"><span class="pre">pbe</span></code> for the ingredient keyword <code class="docutils literal"><span class="pre">mast_xc</span></code> will draw pseudopotentials out of this folder (see <a class="reference internal" href="3_0_inputfile.html"><em>Input File</em></a>).</p>
<p>Rename the GGA PW91 folder to <code class="docutils literal"><span class="pre">POT_GGA_PAW_PW91</span></code>. Ingredients with a value of <code class="docutils literal"><span class="pre">pw91</span></code> for the ingredient keyword <code class="docutils literal"><span class="pre">mast_xc</span></code> will draw pseudopotentials out of this folder.</p>
<p>Example of running the python setup tool:</p>
<div class="highlight-python"><div class="highlight"><pre>Please enter full path where the POT_GGA_PAW_PBE, etc.
subdirs are present.
If you obtained the PSPs directly from VASP, this should
typically be the directory that you untar the files to :

//share/apps/vasp_pseudopotentials/paw

Please enter the fullpath of the where you want to create
your pymatgen resources directory:

//home/&lt;username&gt;/.local/vasp_pps
</pre></div>
</div>
<p>Rename the folders under <code class="docutils literal"><span class="pre">//home/&lt;username&gt;/.local/vasp_pps</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>mv //home/&lt;username&gt;/.local/vasp_pps/&lt;pbe_name&gt; //home/&lt;username&gt;/.local/vasp_pps/POT_GGA_PAW_PBE

mv //home/&lt;username&gt;/.local/vasp_pps/&lt;pw91_name&gt; //home/&lt;username&gt;/.local/vasp_pps/POT_GGA_PAW_PW91
</pre></div>
</div>
<p>For assistance with potcar_setup.py, please contact the
<a class="reference external" href="https://groups.google.com/forum/#!forum/pymatgen">Pymatgen support group</a></p>
</div>
<div class="section" id="add-the-vasp-psp-dir-to-your-user-profile">
<h3>6.3.2. Add the VASP_PSP_DIR to your user profile<a class="headerlink" href="#add-the-vasp-psp-dir-to-your-user-profile" title="Permalink to this headline">¶</a></h3>
<p>Add a line to your user profile exporting the environment variable <code class="docutils literal"><span class="pre">$VASP_PSP_DIR</span></code> to the new pseudopotential directory created above.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>export VASP_PSP_DIR=//home/&lt;username&gt;/.local/vasp_pps
</pre></div>
</div>
<p>Log out and log back in.</p>
<p>Test the change:</p>
<div class="highlight-python"><div class="highlight"><pre>cd $VASP_PSP_DIR
</pre></div>
</div>
<ul class="simple">
<li>Make sure you are getting to the right directory, which has the <code class="docutils literal"><span class="pre">POT_GGA_PAW_PBE</span></code> etc. folders inside it.</li>
</ul>
</div>
</div>
<div class="section" id="set-the-mast-environment-variables">
<span id="mast-setup"></span><h2>6.4. Set the MAST environment variables<a class="headerlink" href="#set-the-mast-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>The pip installation of MAST should have set up a <code class="docutils literal"><span class="pre">MAST</span></code> directory in your home directory, that is, <code class="docutils literal"><span class="pre">//home/&lt;username&gt;/MAST</span></code>.</p>
<p><strong>With conda installation</strong> it appears that this folder is buried under your anaconda directory, like <code class="docutils literal"><span class="pre">./anaconda/lib/python2.7/site-packages/home/&lt;username&gt;/MAST</span></code>. Go ahead and move that MAST folder into your home directory:</p>
<div class="highlight-python"><div class="highlight"><pre>mv ~/anaconda/lib/python2.7/site-packages/home/&lt;username&gt;/MAST ~/.
</pre></div>
</div>
<ul class="simple">
<li>This directory is primarily for storing calculations, and should not be confused with the python module directory, which is where the actual MAST python code resides.</li>
</ul>
<p>Inside <code class="docutils literal"><span class="pre">$HOME/MAST</span></code> there should be:</p>
<ol class="arabic simple">
<li>A <code class="docutils literal"><span class="pre">SCRATCH</span></code> folder:<ul>
<li>Each time an input file is given to MAST, MAST will create a recipe directory inside this folder.</li>
<li>Each recipe directory will itself contain ingredient, or calculation, directories. Calculations will be submitted to the queue from inside these ingredient directories.</li>
<li>Multiple recipes may reside in <code class="docutils literal"><span class="pre">SCRATCH</span></code> at the same time, and MAST will evaluate them alphabetically.</li>
</ul>
</li>
<li>An <code class="docutils literal"><span class="pre">ARCHIVE</span></code> folder:<ul>
<li>When a recipe directory is complete, MAST will move it from <code class="docutils literal"><span class="pre">SCRATCH</span></code> to <code class="docutils literal"><span class="pre">ARCHIVE</span></code>.</li>
</ul>
</li>
<li>A <code class="docutils literal"><span class="pre">CONTROL</span></code> folder:<ul>
<li>MAST requires some control files in order to run. It also does some higher-level logging, and stores that output here.</li>
</ul>
</li>
</ol>
<ul>
<li><p class="first">On some clusters, like Stampede, the home directory is not where you actually want to store calculations. Instead, there may be a separate &#8220;work&#8221; or &#8220;scratch&#8221; directory. In this case, move the entire <code class="docutils literal"><span class="pre">$HOME/MAST</span></code> directory into the work or scratch directory, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>mv $HOME/MAST $WORK/.
</pre></div>
</div>
</li>
</ul>
<p>In this case, the environment variables below should therefore say <code class="docutils literal"><span class="pre">$WORK</span></code> instead of <code class="docutils literal"><span class="pre">$HOME</span></code>.</p>
<ul class="simple">
<li>You can also move the MAST directory anywhere else, as long as you set the environment variables correcty.</li>
</ul>
<p>Copy and paste the environment variables into your user profile, setting the paths correctly if you have moved the <code class="docutils literal"><span class="pre">$HOME/MAST</span></code> directory:</p>
<div class="highlight-python"><div class="highlight"><pre>export MAST_SCRATCH=$HOME/MAST/SCRATCH
export MAST_ARCHIVE=$HOME/MAST/ARCHIVE
export MAST_CONTROL=$HOME/MAST/CONTROL
export MAST_PLATFORM=&lt;platform_name&gt;
</pre></div>
</div>
<p>For platform_name, choose from one of the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">aci</span>
<span class="n">bardeen</span>
<span class="n">dlx</span>
<span class="n">korczak</span>
<span class="n">no_queue_system</span>
<span class="n">pbs_generic</span>
<span class="n">sge_generic</span>
<span class="n">slurm_generic</span>
<span class="n">stampede</span>
<span class="n">turnbull</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>export MAST_PLATFORM=stampede
</pre></div>
</div>
<ul>
<li><p class="first">If your platform is available by name (not _generic), then:</p>
<blockquote>
<div><ul class="simple">
<li>Add the four environment variable lines to your user profile as above.</li>
<li>Log out and log back in.</li>
<li>Go to <a class="reference internal" href="#additional-setup"><span>Additional setup</span></a>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If your platform is not matched exactly, or you would choose one of the generic choices:</p>
<blockquote>
<div><ul class="simple">
<li>Set the three other environment variables (MAST_SCRATCH, MAST_ARCHIVE, and MAST_CONTROL) in your user profile.</li>
<li>Log out and log back in.</li>
<li>Go to <a class="reference internal" href="#make-custom-platform"><span>Make a custom platform, if necessary</span></a>.</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="make-a-custom-platform-if-necessary">
<span id="make-custom-platform"></span><h3>6.4.1. Make a custom platform, if necessary<a class="headerlink" href="#make-a-custom-platform-if-necessary" title="Permalink to this headline">¶</a></h3>
<p>Run the following command. It should produce some errors, but ignore those and just see where MAST is installed:</p>
<div class="highlight-python"><div class="highlight"><pre>mast -i none
</pre></div>
</div>
<p>For example, output may be:</p>
<div class="highlight-python"><div class="highlight"><pre>------------------------------------------------------
Welcome to the MAterials Simulation Toolkit (MAST)
Version: 1.1.5
Installed in: .local/lib/python2.7/site-packages/MAST
------------------------------------------------------
</pre></div>
</div>
<p>and then some errors.</p>
<p>Go to the &#8220;installed in&#8221; directory, and then:</p>
<div class="highlight-python"><div class="highlight"><pre>cd submit/platforms
</pre></div>
</div>
<p>Identify the closest-matching directory to your actual platform (for example, if you have an SGE platform, this directory would be sge_generic)</p>
<p>Copy this directory into a new directory inside the <code class="docutils literal"><span class="pre">platforms</span></code> folder, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>cp -r sge_generic my_custom_sge
</pre></div>
</div>
<p>Then, inside your new folder, like <code class="docutils literal"><span class="pre">my_custom_sge</span></code>, modify each of the following files as necessary for your platform:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">submit_template</span><span class="o">.</span><span class="n">sh</span>
<span class="n">mastmon_submit</span><span class="o">.</span><span class="n">sh</span>
<span class="n">queue_commands</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Explanations for each file are given in the following sections. Modify and test each file in your new custom platform folder.</p>
<p>Then, in your user profile, use your new custom folder for the platform name of <code class="docutils literal"><span class="pre">$MAST_PLATFORM</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>export MAST_PLATFORM=my_custom_sge
</pre></div>
</div>
<p>Log out and log back in.</p>
<div class="section" id="submit-template-sh">
<h4>6.4.1.1. submit_template.sh<a class="headerlink" href="#submit-template-sh" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">submit_template.sh</span></code> is the generic submission template from which ingredient submission templates will be created.</p>
<ul class="simple">
<li>MAST will replace anything inside question marks, for example <code class="docutils literal"><span class="pre">?mast_ppn?</span></code> with the value of the appropriate keyword.</li>
</ul>
<p>The following keywords may be used; see <a class="reference internal" href="3_0_inputfile.html"><em>Input File</em></a> for more information on each keyword.</p>
<ul class="simple">
<li>mast_processors</li>
<li>mast_ppn</li>
<li>mast_nodes</li>
<li>mast_queue</li>
<li>mast_exec</li>
<li>mast_walltime</li>
<li>mast_memory</li>
<li>mast_name (the ingredient name)</li>
</ul>
<p>Examine the template carefully, as an error here will prevent your ingredients from running successfully on the queue.</p>
<ul>
<li><p class="first">The provided template should be a good match for its platform.</p>
<blockquote>
<div><ul class="simple">
<li>Otherwise, you can take one of your normal submission templates and substitute in <code class="docutils literal"><span class="pre">?mast_xxx?</span></code> fields where appropriate.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Or, vice versa, you can take the provided template, replace the <code class="docutils literal"><span class="pre">?mast_xxx?</span></code> fields with some reasonable values, and see if filled-in submission template will run a job if submitted normally using <code class="docutils literal"><span class="pre">qsub</span></code>, <code class="docutils literal"><span class="pre">sbatch</span></code>, etc.</p>
</li>
</ul>
</div>
<div class="section" id="mastmon-submit-sh">
<h4>6.4.1.2. mastmon_submit.sh<a class="headerlink" href="#mastmon-submit-sh" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">mastmon_submit.sh</span></code> is the submission template that will submit the MAST Monitor to the queue every time <code class="docutils literal"><span class="pre">mast</span></code> is called.</p>
<p>The MAST Monitor will check the completion status of every recipe and ingredient in the <code class="docutils literal"><span class="pre">$MAST_SCRATCH</span></code> folder.</p>
<ul class="simple">
<li>If you have a recipe you would like to skip temporarily, manually put a file named <code class="docutils literal"><span class="pre">MAST_SKIP</span></code> inside that recipe&#8217;s folder in <code class="docutils literal"><span class="pre">$MAST_SCRATCH</span></code>. <code class="docutils literal"><span class="pre">MAST_SKIP</span></code> can be an empty file, or it can contain notes; MAST does not check its contents.</li>
<li><code class="docutils literal"><span class="pre">mastmon_submit.sh</span></code> should be set to run on the shortest-wallclock, fastest-turnaround queue available, e.g. a serial queue</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">mastmon_submit.sh</span></code> script is copied into the <code class="docutils literal"><span class="pre">$MAST_CONTROL</span></code> directory every time you run <code class="docutils literal"><span class="pre">mast</span></code>.</p>
<p>If you see that after you type <code class="docutils literal"><span class="pre">mast</span></code>, no &#8220;mastmon&#8221; process appears on the queue, then test the submission script directly:</p>
<div class="highlight-python"><div class="highlight"><pre>cd $MAST_CONTROL
qsub mastmon_submit.sh (or use sbatch for slurm, etc.)
</pre></div>
</div>
<ul class="simple">
<li>Modify the <code class="docutils literal"><span class="pre">$MAST_CONTROL/mastmon_submit.sh</span></code> file until it the &#8220;mastmon&#8221; process successfully runs on the queue.</li>
<li>Copy your changes into the <code class="docutils literal"><span class="pre">&lt;MAST</span> <span class="pre">installation</span> <span class="pre">directory&gt;/submit/platforms/&lt;platform&gt;/mastmon_submit.sh</span></code> file so that your changes will be reflected the next time that you run MAST.</li>
</ul>
</div>
<div class="section" id="queue-commands-py">
<h4>6.4.1.3. queue_commands.py<a class="headerlink" href="#queue-commands-py" title="Permalink to this headline">¶</a></h4>
<p>These queue commands will be used to submit ingredients to the queue and retrieve the job IDs and statuses of ingredients on the queue.</p>
<ul class="simple">
<li>For a custom platform, modify the <code class="docutils literal"><span class="pre">&lt;MAST</span> <span class="pre">installation</span> <span class="pre">directory&gt;/submit/platforms/&lt;your</span> <span class="pre">custom</span> <span class="pre">platform&gt;/queue_commands.py</span></code> file.</li>
<li>Do not modify the <code class="docutils literal"><span class="pre">&lt;MAST</span> <span class="pre">installation</span> <span class="pre">directory/submit/queue_commands.py</span></code> file.</li>
</ul>
<p>Modify the following python functions as necessary:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">queue_submission_command</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>This function should return the correct queue submission command,</li>
<li>For example, this function should return <code class="docutils literal"><span class="pre">qsub</span></code> on PBS/Torque, or <code class="docutils literal"><span class="pre">sbatch</span></code> on slurm.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">extract_submitted_jobid</span></code>:</p>
<blockquote>
<div><ul>
<li><p class="first">This function should parse the job ID, given the text that returns to screen when you submit a job.</p>
</li>
<li><p class="first">For example, it should return <code class="docutils literal"><span class="pre">456789</span></code> as the jobid for the following job submission and resulting screen text:</p>
<div class="highlight-python"><div class="highlight"><pre>login2.mycluster$ sbatch submit.sh
-----------------------------------------------------------------
          Welcome to the Supercomputer
-----------------------------------------------------------------
--&gt; Verifying valid submit host (login2)...OK
--&gt; Verifying valid jobname...OK
--&gt; Enforcing max jobs per user...OK
--&gt; Verifying job request is within current queue limits...OK
Submitted batch job 456789
</pre></div>
</div>
</li>
<li><p class="first">On a different cluster, it would return <code class="docutils literal"><span class="pre">456789</span></code> as the jobid for the following submission and resulting screen text:</p>
<div class="highlight-python"><div class="highlight"><pre>[user1@mycluster test_job]$ qsub submit.sh
456789.mycluster.abcd.univ.edu
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">queue_snap_command</span></code>:</p>
<blockquote>
<div><ul>
<li><p class="first">This function should show a summary of your current submitted jobs, which we call the <code class="docutils literal"><span class="pre">queue_snapshot</span></code>.</p>
</li>
<li><p class="first">For example, the queue snapshot command should return something like the following (platform-dependent):</p>
<div class="highlight-python"><div class="highlight"><pre>JOBID   PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
456789      normal test1 user1 PD       0:00      4 (Resources)
456788      normal test2 user1 PD       0:00      1 (Resources)
456774      normal test3 user1  R    6:14:53      1 c123-124
456775      normal test4 user1  R    6:15:34      1 c125-126
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">queue_status_from_text</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>This function should return the status of a specific job, based on the job number.</li>
<li>For example, job 456789 in the queue snapshot above, with status &#8220;PD&#8221; should correspond to a &#8220;Q&#8221; status (queued status) for MAST.</li>
<li>Job 456775 in the queue snapshot above, with status &#8220;R&#8221;, should correspond to an &#8220;R&#8221; status (running status) for MAST.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">get_approx_job_error_file</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>This function should return the name of the job error file.</li>
<li>The name of this file will depend on what is specified in <code class="docutils literal"><span class="pre">submit_template.sh</span></code> and is usually something like <code class="docutils literal"><span class="pre">slurm.&lt;jobnumber&gt;</span></code> or <code class="docutils literal"><span class="pre">&lt;jobname&gt;.e&lt;jobnumber&gt;</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="additional-setup">
<span id="id1"></span><h2>6.5. Additional setup<a class="headerlink" href="#additional-setup" title="Permalink to this headline">¶</a></h2>
<p>You may need to do any or all of the following:</p>
<ul>
<li><p class="first">Identify the correct <code class="docutils literal"><span class="pre">mast_exec</span></code> call for your system.</p>
<blockquote>
<div><ul>
<li><p class="first">For example, suppose you run VASP like this:</p>
<div class="highlight-python"><div class="highlight"><pre>//opt/mpiexec/bin/mpiexec //share/apps/bin/vasp5.2_par_opt1
</pre></div>
</div>
</li>
<li><p class="first">Then, in your input files, the <code class="docutils literal"><span class="pre">mast_exec</span></code> keyword would be specified like this:</p>
<div class="highlight-python"><div class="highlight"><pre>mast_exec //opt/mpiexec/bin/mpiexec //share/apps/bin/vasp5.2_par_opt1
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Add additional lines to your user profile which allow you to run VASP, including any modules that need to be imported, additions to your library path, unlimiting the stack size, and so on.</p>
</li>
<li><p class="first">Modify your text editor settings so that tabs become four spaces (or so that you have such an option readily available). This setting is very important to ensure that MAST can read the input file, especially the recipe section of the input file.</p>
<blockquote>
<div><ul>
<li><p class="first">If you use VIM (<code class="docutils literal"><span class="pre">vi</span></code>), add the following lines to your <code class="docutils literal"><span class="pre">~/.vimrc</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot; VIM settings for python in a group below:
set tabstop=4
set shiftwidth=4
set smarttab
set expandtab
set softtabstop=4
set autoindent
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Once you have completed any additional setup and have identified what <code class="docutils literal"><span class="pre">mast_exec</span></code> should be, go to <a class="reference internal" href="17_0_testmast.html"><em>Trying out MAST</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/MAST_logo_200px.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6. Installation</a><ul>
<li><a class="reference internal" href="#do-pre-installation-steps">6.1. Do pre-installation steps</a><ul>
<li><a class="reference internal" href="#locate-your-user-profile">6.1.1. Locate your user profile</a></li>
<li><a class="reference internal" href="#use-your-cluster-correctly">6.1.2. Use your cluster correctly</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-local-python-version-and-dependencies">6.2. Install local python version and dependencies</a><ul>
<li><a class="reference internal" href="#install-anaconda-python">6.2.1. Install Anaconda python</a></li>
<li><a class="reference internal" href="#install-the-mast-package">6.2.2. Install the MAST package</a></li>
<li><a class="reference internal" href="#install-additional-dependencies">6.2.3. Install additional dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-up-the-pymatgen-vasp-psp-dir">6.3. Set up the pymatgen VASP_PSP_DIR</a><ul>
<li><a class="reference internal" href="#set-up-the-pseudopotential-folders">6.3.1. Set up the pseudopotential folders</a></li>
<li><a class="reference internal" href="#add-the-vasp-psp-dir-to-your-user-profile">6.3.2. Add the VASP_PSP_DIR to your user profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-the-mast-environment-variables">6.4. Set the MAST environment variables</a><ul>
<li><a class="reference internal" href="#make-a-custom-platform-if-necessary">6.4.1. Make a custom platform, if necessary</a><ul>
<li><a class="reference internal" href="#submit-template-sh">6.4.1.1. submit_template.sh</a></li>
<li><a class="reference internal" href="#mastmon-submit-sh">6.4.1.2. mastmon_submit.sh</a></li>
<li><a class="reference internal" href="#queue-commands-py">6.4.1.3. queue_commands.py</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#additional-setup">6.5. Additional setup</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="4_0_recipe.html"
                        title="previous chapter">5. Recipes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="17_0_testmast.html"
                        title="next chapter">7. Trying out MAST</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="17_0_testmast.html" title="7. Trying out MAST"
             >next</a> |</li>
        <li class="right" >
          <a href="4_0_recipe.html" title="5. Recipes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MAST 1.3.0.17 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, University of Wisconsin-Madison Compuational Materials Group.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>