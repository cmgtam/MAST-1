#!/usr/bin/env python

import sys, os

from MAST.utility.defect_formation_energy import DefectFormationEnergy
from MAST.utility import Metadata


def main():
    archive = os.path.expandvars(os.environ['MAST_ARCHIVE'])

    dir_list = os.listdir(archive)
    print 'Found %i completed jobs in %s:\n' % (len(dir_list), archive)

    for ndir, directory in enumerate(dir_list):
        metafile = Metadata(metafile='%s/%s/metadata.txt' % (archive, directory))
        system = metafile.read_data('system_name')
        date = metafile.read_data('directory_created')

        print '%i) %s, which ran on %s' % (ndir, system, date)

    print '\nPlease select a recipe from the above list to calculate the defect formation energies for:'
    index = int(sys.stdin.readline())
    #print 'Index selected:', index

    directory = dir_list[index]
    metafile = Metadata(metafile='%s/%s/metadata.txt' % (archive, directory))
    system = metafile.read_data('system_name')
    date = metafile.read_data('directory_created')

    print 'You have selected %s, which ran on %s.' % (system, date)
    print 'Calculating defect formation energies now.'

    directory_path = '%s/%s/' % (archive, directory)
    DFE = DefectFormationEnergy(directory=directory_path)
    #defect_energies = DFE.calculate_defect_formation_energies()
    DFE.print_table()

if __name__ == '__main__':
    main()
